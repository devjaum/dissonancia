import{a as Y,b as G,c as J,d as Q,f as X,g as Z,h as ee,i as te}from"./chunk-ZIR2ZB4B.js";import{j as ne}from"./chunk-KLQ32EPB.js";import{$ as b,A as m,B as p,Ca as q,Da as z,Ea as j,Ga as K,Ja as U,N as l,S as R,T as $,X as M,aa as r,ba as o,ca as V,da as P,ea as v,fa as d,ha as A,ia as W,ja as s,ka as H,la as O,ma as F,n as L,na as x,oa as _,pa as y,w as B}from"./chunk-YJ7IANYW.js";function re(c,n){if(c&1){let e=P();r(0,"div",20)(1,"div",21)(2,"label"),s(3,"FOR"),o(),r(4,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.player.str,t)||(a.player.str=t),p(t)}),o()(),r(5,"div",21)(6,"label"),s(7,"DES"),o(),r(8,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.player.dex,t)||(a.player.dex=t),p(t)}),o()(),r(9,"div",21)(10,"label"),s(11,"CON"),o(),r(12,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.player.con,t)||(a.player.con=t),p(t)}),o()(),r(13,"div",21)(14,"label"),s(15,"INT"),o(),r(16,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.player.int,t)||(a.player.int=t),p(t)}),o()(),r(17,"div",21)(18,"label"),s(19,"SAB"),o(),r(20,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.player.wis,t)||(a.player.wis=t),p(t)}),o()(),r(21,"div",21)(22,"label"),s(23,"CAR"),o(),r(24,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.player.cha,t)||(a.player.cha=t),p(t)}),o()()()}if(c&2){let e=d();l(4),x("ngModel",e.player.str),l(4),x("ngModel",e.player.dex),l(4),x("ngModel",e.player.con),l(4),x("ngModel",e.player.int),l(4),x("ngModel",e.player.wis),l(4),x("ngModel",e.player.cha)}}function oe(c,n){if(c&1&&(r(0,"option",30),s(1),o()),c&2){let e=n.$implicit;b("ngValue",e),l(),O(" ",e.label," ")}}function ae(c,n){if(c&1){let e=P();r(0,"div",23)(1,"div",24)(2,"label"),s(3,"Estilo de Combate:"),o(),r(4,"select",25),y("ngModelChange",function(t){m(e);let a=d();return _(a.selectedAttack,t)||(a.selectedAttack=t),p(t)}),M(5,oe,2,2,"option",26),o()(),r(6,"button",27),v("click",function(){m(e);let t=d();return p(t.performAttack(t.player,t.enemy,0,4))}),s(7),o(),r(8,"button",28),v("click",function(){m(e);let t=d();return p(t.performAttack(t.player,t.enemy,-1,6))}),s(9," Pesado (-1 Dado, +2 Dano) "),o(),r(10,"button",29),v("click",function(){m(e);let t=d();return p(t.dodge(t.player))}),s(11," Dodge Esquivar (+2 Defesa at\xE9 o pr\xF3ximo turno) "),o()()}if(c&2){let e=d();l(4),x("ngModel",e.selectedAttack),l(),b("ngForOf",e.attackOptions),l(2),O(" Atacar (",e.player[e.selectedAttack.attr],"d6) ")}}function le(c,n){if(c&1){let e=P();r(0,"div",20)(1,"div",21)(2,"label"),s(3,"FOR"),o(),r(4,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.enemy.str,t)||(a.enemy.str=t),p(t)}),o()(),r(5,"div",21)(6,"label"),s(7,"DES"),o(),r(8,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.enemy.dex,t)||(a.enemy.dex=t),p(t)}),o()(),r(9,"div",21)(10,"label"),s(11,"CON"),o(),r(12,"input",22),y("ngModelChange",function(t){m(e);let a=d();return _(a.enemy.con,t)||(a.enemy.con=t),p(t)}),o()()()}if(c&2){let e=d();l(4),x("ngModel",e.enemy.str),l(4),x("ngModel",e.enemy.dex),l(4),x("ngModel",e.enemy.con)}}function se(c,n){if(c&1){let e=P();r(0,"button",31),v("click",function(){m(e);let t=d();return p(t.startBattle())}),s(1,"INICIAR SIMULA\xC7\xC3O"),o()}}function ce(c,n){if(c&1){let e=P();r(0,"button",32),v("click",function(){m(e);let t=d();return p(t.reset())}),s(1,"REINICIAR"),o()}}function de(c,n){if(c&1&&(r(0,"p",33)(1,"span",34),s(2,">>"),o(),s(3),o()),c&2){let e=n.$implicit;b("ngClass",e.type),l(3),O(" ",e.message," ")}}var ie=class c{constructor(n){this.router=n;this.calculateStats(this.player),this.calculateStats(this.enemy)}dbService=B(ne);character$=this.dbService.getCharacterByEmail().pipe(L(n=>{if(!n){let w=4,N=2;return{name:"Her\xF3i",isPlayer:!0,str:3,dex:w,con:N,int:5,wis:1,cha:5,maxHp:0,currentHp:0,passiveDef:1+Math.max(w,N)/2,magicDef:1+Math.max(5,1)/2,initiative:0,isDodging:!1,fatigue:!1}}let e=n.status||[0,0,0,0,0,0],i=Array.isArray(n.talent)?n.talent:[],t=n.name||"Her\xF3i",a=Number(e[0])||0,u=Number(e[1])||0,g=Number(e[2])||0,f=Number(e[3])||0,k=Number(e[4])||0,S=Number(e[5])||0,E=i.includes("Vigoroso"),h=n.vidaExtra||0,C=5+g*10+a*5+(E?10:0)+h,T=1+Math.max(Math.floor(u/2),Math.floor(g/2)),D=1+Math.max(Math.floor(k/2),Math.floor(f/2)),I=u+Math.floor(Math.random()*6)+1;return{name:t,isPlayer:!0,str:a,dex:u,con:g,int:f,wis:k,cha:S,maxHp:C,currentHp:C,passiveDef:T,magicDef:D,initiative:I}}));battleLog=[];turnTotal=0;battleStarted=!1;turnOrder=[];currentTurnIndex=0;attackOptions=[{label:"\u{1F5E1}\uFE0F Arma Leve (DES)",attr:"dex"},{label:"\u{1F528} Arma Pesada (FOR)",attr:"str"},{label:"\u{1F52E} Magia Arcana (INT)",attr:"int"},{label:"\u2728 Magia Espiritual (SAB)",attr:"wis"},{label:"\u{1F5E3}\uFE0F Encantamento (CAR)",attr:"cha"}];selectedAttack=this.attackOptions[0];player={name:"Her\xF3i",isPlayer:!0,str:3,dex:4,con:3,int:2,wis:2,cha:2,maxHp:0,currentHp:0,passiveDef:0,magicDef:0,initiative:0,isDodging:!1,fatigue:!1};ngOnInit(){this.character$.subscribe(n=>this.player=n)}enemy={name:"Sombra",isPlayer:!1,str:4,dex:2,con:3,int:1,wis:2,cha:1,maxHp:0,currentHp:0,passiveDef:0,magicDef:0,initiative:0,isDodging:!1,fatigue:!1};calculateStats(n){n.maxHp=5+n.con*10+n.str*5,n.currentHp=n.maxHp;let e=Math.floor(n.dex/2),i=Math.floor(n.con/2);n.passiveDef=1+Math.max(e,i)}rollPool(n,e=0){let i=n+e,t=[],a=0;if(i<=0){let u=Math.floor(Math.random()*6)+1,g=Math.floor(Math.random()*6)+1;return t.push(u,g),Math.min(u,g)>=4&&(a=1),{successes:a,rolls:t}}for(let u=0;u<i;u++){let g=Math.floor(Math.random()*6)+1;t.push(g),g>=4&&a++}return{successes:a,rolls:t}}startBattle(){this.calculateStats(this.player),this.calculateStats(this.enemy),this.battleLog=[],this.log("=== IN\xCDCIO DO COMBATE ===","system");let n=Math.floor(Math.random()*6)+1;this.player.initiative=this.player.dex+n,this.log(`${this.player.name} Iniciativa: ${this.player.dex} + ${n} = ${this.player.initiative}`,"player");let e=Math.floor(Math.random()*6)+1;this.enemy.initiative=this.enemy.dex+e,this.log(`${this.enemy.name} Iniciativa: ${this.enemy.dex} + ${e} = ${this.enemy.initiative}`,"enemy"),this.player.initiative>=this.enemy.initiative?(this.turnOrder=[this.player,this.enemy],this.log(`>> ${this.player.name} age primeiro!`,"system")):(this.turnOrder=[this.enemy,this.player],this.log(`>> ${this.enemy.name} age primeiro!`,"system")),this.battleStarted=!0,this.currentTurnIndex=0,this.checkTurn()}checkTurn(){let n=this.turnOrder[this.currentTurnIndex];n.isPlayer||setTimeout(()=>this.performAttack(n,this.player),500),n.isPlayer&&(this.turnTotal=Number(this.turnTotal)+1)}nextTurn(){this.player.currentHp<=0||this.enemy.currentHp<=0||(this.currentTurnIndex=(this.currentTurnIndex+1)%2,this.checkTurn())}performAttack(n,e,i=0,t=4){let a,u,g=n.isPlayer?"player":"enemy";if(n.isPlayer)a=n[this.selectedAttack.attr],u=this.selectedAttack.label;else if(Math.floor(Math.random()*2)===0)a=n.str>n.dex?n.str:n.dex,u=n.str>n.dex?"\u{1F528} Arma Pesada (FOR)":"\u{1F5E1}\uFE0F Arma Leve (DES)";else{this.dodge(n);return}this.log(`${n.name} usa ${u}!`,g);let f=this.rollPool(a,i),k=f.rolls.join(", "),S=0,E=!1;if(e.isDodging){E=!0,this.log(`\u{1F938} ${e.name} tenta esquivar do ataque!`,e.isPlayer?"player":"enemy");let h=this.rollPool(e.dex);if(this.log(`\u{1F3B2} Ataque [${k}] (${f.successes}) VS Esquiva [${h.rolls.join(", ")}] (${h.successes})`,"system"),h.successes>f.successes){this.log(`\u{1F4A8} ${e.name} esquivou completamente!`,"critical"),e.isDodging=!1,this.checkWinCondition(),this.battleStarted&&this.nextTurn();return}else this.log("\u{1F4A5} A esquiva falhou!","fail"),S=0;e.isDodging=!1}else S=e.passiveDef,this.log(`\u{1F3B2} Dados: [${k}] -> ${f.successes} Sucessos (DT ${S})`,"system");if(E||f.successes>=S){let h=0,C="";if(E){let w=Math.floor(Math.random()*6)+1;w>4?(h=Math.max(0,f.successes-e.passiveDef),C=" (Defesa parcial)",this.log(`\u{1F3B2} Sorte na defesa [${w}]. Armadura absorveu parte do impacto!`,"system")):(h=f.successes,C=" (Guarda Aberta!)",this.log(`\u{1F3B2} Azar na defesa [${w}]. Dano direto sem armadura!`,"fail"))}else h=f.successes-e.passiveDef;let T=h*2,D=t+T;e.currentHp-=D,e.currentHp<0&&(e.currentHp=0);let I=T>0?` (CR\xCDTICO +${T}${C})`:C;this.log(`\u{1FA78} ACERTOU! Dano: ${t}${I} = ${D}`,"critical")}else this.log("\u{1F6E1}\uFE0F Bloqueado pela Defesa Passiva.","fail");this.checkWinCondition(),this.battleStarted&&this.nextTurn()}dodge(n){n.fatigue=!0,n.isDodging=!0,this.log(`${n.name} assume postura de esquiva!`,n.isPlayer?"player":"enemy"),this.log(`>> ${n.name} tentar\xE1 superar os sucessos do pr\xF3ximo ataque.`,"system"),this.nextTurn()}checkWinCondition(){this.player.currentHp<=0?(this.log(`Total de turnos: ${this.turnTotal}`,"system"),this.log(`\u{1F480} ${this.player.name} foi derrotado.`,"fail"),this.battleStarted=!1):this.enemy.currentHp<=0&&(this.log(`Total de turnos: ${this.turnTotal}`,"system"),this.log(`\u{1F3C6} ${this.enemy.name} foi eliminado!`,"critical"),this.battleStarted=!1)}log(n,e){this.battleLog.push({message:n,type:e}),setTimeout(()=>{let i=document.getElementsByClassName("logs")[0];i&&(i.scrollTop=-i.scrollHeight)},100)}reset(){this.battleStarted=!1,this.battleLog=[],this.calculateStats(this.player),this.calculateStats(this.enemy)}home(){this.dbService.isAuthenticated().subscribe(n=>{n?this.router.navigate(["/home"]):this.router.navigate(["/guest"])})}static \u0275fac=function(e){return new(e||c)(R(U))};static \u0275cmp=$({type:c,selectors:[["app-simulator"]],decls:39,vars:22,consts:[[1,"sim-container"],[1,"glitch-title"],[1,"battle-arena"],[1,"fighter-card","player-side"],[1,"hp-bar-container"],[1,"hp-bar"],[1,"hp-text"],["class","stats-config",4,"ngIf"],[1,"derived-stats"],["class","actions",4,"ngIf"],[1,"vs"],[1,"fighter-card","enemy-side"],[1,"hp-bar","enemy-hp"],[1,"controls"],["class","btn-start",3,"click",4,"ngIf"],["class","btn-reset",3,"click",4,"ngIf"],[1,"console-log"],[1,"logs"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"btn-home",3,"click"],[1,"stats-config"],[1,"stat-input"],["type","number",3,"ngModelChange","ngModel"],[1,"actions"],[1,"attack-selector"],[3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"btn-action","attack",3,"click"],[1,"btn-action","heavy",3,"click"],[1,"btn-action","dodge",3,"click"],[3,"ngValue"],[1,"btn-start",3,"click"],[1,"btn-reset",3,"click"],[3,"ngClass"],[1,"prefix"]],template:function(e,i){e&1&&(r(0,"main",0)(1,"h1",1),s(2,"Simulador de Combate"),o(),r(3,"div",2)(4,"div",3)(5,"h2"),s(6),o(),r(7,"div",4),V(8,"div",5),r(9,"span",6),s(10),o()(),M(11,re,25,6,"div",7),r(12,"div",8)(13,"p"),s(14),o()(),M(15,ae,12,3,"div",9),o(),r(16,"div",10),s(17,"VS"),o(),r(18,"div",11)(19,"h2"),s(20),o(),r(21,"div",4),V(22,"div",12),r(23,"span",6),s(24),o()(),M(25,le,13,3,"div",7),r(26,"div",8)(27,"p"),s(28),o()()()(),r(29,"div",13),M(30,se,2,0,"button",14)(31,ce,2,0,"button",15),o(),r(32,"div",16)(33,"h3"),s(34,">> Registro de Combate_"),o(),r(35,"div",17),M(36,de,4,2,"p",18),o()(),r(37,"button",19),v("click",function(){return i.home()}),s(38," Voltar "),o()()),e&2&&(l(4),W("active-turn",i.battleStarted&&i.turnOrder[i.currentTurnIndex]===i.player),l(2),H(i.player.name),l(2),A("width",i.player.currentHp/i.player.maxHp*100,"%"),l(2),F("",i.player.currentHp," / ",i.player.maxHp," PV"),l(),b("ngIf",!i.battleStarted),l(3),O("\u{1F6E1}\uFE0F Defesa F\xEDsica: ",i.player.passiveDef),l(),b("ngIf",i.battleStarted&&i.turnOrder[i.currentTurnIndex]===i.player),l(3),W("active-turn",i.battleStarted&&i.turnOrder[i.currentTurnIndex]===i.enemy),l(2),H(i.enemy.name),l(2),A("width",i.enemy.currentHp/i.enemy.maxHp*100,"%"),l(2),F("",i.enemy.currentHp," / ",i.enemy.maxHp," PV"),l(),b("ngIf",!i.battleStarted),l(3),O("\u{1F6E1}\uFE0F Defesa F\xEDsica: ",i.enemy.passiveDef),l(2),b("ngIf",!i.battleStarted),l(),b("ngIf",i.battleStarted),l(5),b("ngForOf",i.battleLog))},dependencies:[K,q,z,j,te,Z,ee,Y,Q,X,G,J],styles:[".sim-container[_ngcontent-%COMP%]{padding:20px;min-height:100vh;display:flex;flex-direction:column;align-items:center;color:#fff;font-family:Roboto,sans-serif}.glitch-title[_ngcontent-%COMP%]{color:var(--accent-color);text-transform:uppercase;letter-spacing:2px;margin-bottom:30px}.battle-arena[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;gap:20px;width:100%;max-width:900px;flex-wrap:wrap}.vs[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#ff00c8;align-self:center}.fighter-card[_ngcontent-%COMP%]{background-color:var(--card-bg);border:1px solid #444;border-radius:8px;padding:20px;width:300px;display:flex;flex-direction:column;gap:15px;transition:all .3s}.fighter-card.active-turn[_ngcontent-%COMP%]{border-color:#00fff9;box-shadow:0 0 15px #00fff94d;transform:scale(1.02)}.player-side[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#00fff9}.enemy-side[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#ef5350}.hp-bar-container[_ngcontent-%COMP%]{width:100%;height:25px;background-color:#333;border-radius:4px;position:relative;overflow:hidden}.hp-bar[_ngcontent-%COMP%]{height:100%;background-color:#00e676;transition:width .5s ease-out}.hp-bar.enemy-hp[_ngcontent-%COMP%]{background-color:#ef5350}.hp-text[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:.8rem;font-weight:700;text-shadow:1px 1px 2px black}.stats-config[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px;background:#0003;padding:10px;border-radius:4px}.stat-input[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.stat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:40px;background:#111;border:1px solid #555;color:#fff;padding:4px;text-align:center;border-radius:4px}.attack-selector[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;margin-bottom:5px}.attack-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.8rem;color:#aaa}.attack-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{background-color:#111;color:#00fff9;border:1px solid var(--accent-color);padding:8px;border-radius:4px;font-family:inherit;cursor:pointer;outline:none}.attack-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{box-shadow:0 0 5px var(--accent-color)}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-top:5px;animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.btn-action[_ngcontent-%COMP%]{padding:12px;border:none;border-radius:4px;font-weight:700;cursor:pointer;text-transform:uppercase;transition:.2s}.btn-action.attack[_ngcontent-%COMP%]{background-color:var(--accent-color);color:#000}.btn-action.attack[_ngcontent-%COMP%]:hover{background-color:#fff;box-shadow:0 0 10px var(--accent-color)}.btn-action.dodge[_ngcontent-%COMP%]{background-color:#50c878;color:#000;border:1px solid #555}.btn-action.dodge[_ngcontent-%COMP%]:hover{background-color:#66d88f;border-color:#fff}.btn-action.heavy[_ngcontent-%COMP%]{background-color:#444;color:#fff;border:1px solid #666}.btn-action.heavy[_ngcontent-%COMP%]:hover{background-color:#555;border-color:#fff}@media (max-width: 700px){.battle-arena[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.fighter-card[_ngcontent-%COMP%]{width:100%}}",".console-log[_ngcontent-%COMP%]{margin-top:30px;width:100%;max-width:800px;background-color:#0a0a0a;border:1px solid var(--accent-color);border-radius:4px;padding:15px;font-family:Courier New,monospace;height:200px;display:flex;flex-direction:column}.logs[_ngcontent-%COMP%]{overflow-y:auto;flex:1;display:flex;flex-direction:column-reverse}.logs[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;font-size:.9rem;border-bottom:1px solid #222;padding-bottom:2px}.btn-start[_ngcontent-%COMP%]{margin-top:20px;padding:15px 40px;background-color:#ff00c8;color:#fff;border:none;font-size:1.2rem;font-weight:700;cursor:pointer;clip-path:polygon(10% 0,100% 0,100% 80%,90% 100%,0 100%,0 20%)}.btn-start[_ngcontent-%COMP%]:hover{background-color:#ff40d6;transform:scale(1.05)}.btn-reset[_ngcontent-%COMP%]{margin-top:20px;padding:10px 20px;background-color:#333;color:#aaa;border:1px solid #555;cursor:pointer}.console-log[_ngcontent-%COMP%]{margin-top:30px;width:100%;max-width:800px;background-color:#0a0a0a;border:1px solid var(--accent-color);border-radius:4px;padding:15px;font-family:Courier New,monospace;height:250px;display:flex;flex-direction:column;box-shadow:0 0 20px #00000080}.logs[_ngcontent-%COMP%]{overflow-y:auto;flex:1;display:flex;flex-direction:column-reverse;padding-right:5px}.logs[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;font-size:.95rem;padding:4px 8px;border-radius:3px;line-height:1.4;border-left:3px solid transparent}.prefix[_ngcontent-%COMP%]{opacity:.5;margin-right:5px}.logs[_ngcontent-%COMP%]   p.player[_ngcontent-%COMP%]{color:#00fff9;background-color:#00fff90d;border-left-color:#00fff9}.logs[_ngcontent-%COMP%]   p.enemy[_ngcontent-%COMP%]{color:#ef5350;background-color:#ef53500d;border-left-color:#ef5350}.logs[_ngcontent-%COMP%]   p.system[_ngcontent-%COMP%]{color:#bbb;font-style:italic;font-size:.85rem}.logs[_ngcontent-%COMP%]   p.critical[_ngcontent-%COMP%]{color:gold;font-weight:700;text-shadow:0 0 5px rgba(255,215,0,.5);border-left-color:gold}.logs[_ngcontent-%COMP%]   p.fail[_ngcontent-%COMP%]{color:#777;text-decoration:line-through}.logs[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.logs[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--accent-color);border-radius:4px}.logs[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#111}.btn-home[_ngcontent-%COMP%]{margin-top:20px;padding:10px 20px;background-color:#222;color:#aaa;border:1px solid #555;cursor:pointer}.btn-home[_ngcontent-%COMP%]:hover{background-color:#333;color:#fff}"]})};export{ie as Simulator};
