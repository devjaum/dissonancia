<main class="home-container">
    
    <button class="btnMonster" (click)="monsterPedia()">
        MENU MONSTRUÁRIO
    </button>

    <div *ngIf="character$ | async as player; else loading" class="content-wrapper">
        
        <h1 class="glitch-title">Identidade do Sistema</h1>

        <div class="card-container">
            <div class="card" [class.flipped]="isFlipped" (click)="toggleFlip()">
                
                <div class="cardFront">
                    <div class="front-sidebar">
                        <div class="avatar-placeholder">
                            {{player.name?.charAt(0) || '?'}}
                        </div>
                        <div class="sidebar-text">
                            <h2 class="player-name">{{player.name || 'Desconhecido'}}</h2>
                            <div class="player-class">{{player.class || 'Sem Classe'}}</div>
                            <small style="color:#666; display:block; margin-top:5px">{{player.email}}</small>
                        </div>
                    </div>

                    <div class="front-main">
                        <div class="vitals-container">
                            <div class="vital-row">
                                <span class="vital-label">VIDA</span>
                                <div class="bar-bg">
                                    <div class="bar-fill hp-fill" style="width: 100%"></div> </div>
                                <span class="vital-value">{{player.vida}}</span>
                            </div>
                            <div class="vital-row">
                                <span class="vital-label">MANA</span>
                                <div class="bar-bg">
                                    <div class="bar-fill mana-fill" style="width: 100%"></div>
                                </div>
                                <span class="vital-value">{{player.mana}}</span>
                            </div>
                            <div class="vital-row">
                                <span class="vital-label">SHINSU</span>
                                <div class="bar-bg">
                                    <div class="bar-fill shinsu-fill" style="width: 100%"></div>
                                </div>
                                <span class="vital-value">{{player.shinsu}}</span>
                            </div>
                        </div>

                        <div class="lore-section">
                            <h4>Registro de Memória</h4>
                            <div class="lore-text">
                                {{player.lore || 'Nenhum dado registrado...'}}
                            </div>
                        </div>
                        
                        <div class="click-hint">> ACESSAR DADOS DE COMBATE (CLIQUE)</div>
                    </div>
                </div>

                <div class="cardBack">
                    <div class="back-header">
                        <h3>STATUS DE COMBATE</h3>
                        <small style="color: #666">SISTEMA V.1.0</small>
                    </div>

                    <div class="back-body">
                        <div class="col-left">
                            <div class="section-box">
                                <span class="section-title">Habilidades Únicas</span>
                                <div *ngIf="player.uniqueSkills?.length; else noSkills">
                                    <div *ngFor="let skill of player.uniqueSkills" class="skill-row" [attr.data-tooltip]="skill.description">
                                        <strong>{{skill.name}}</strong>
                                    </div>
                                </div>
                                <ng-template #noSkills><small style="color:#555">Nenhuma habilidade.</small></ng-template>
                            </div>

                            <div class="section-box">
                                <span class="section-title">Talentos</span>
                                <div class="talents-flex">
                                    <span *ngFor="let t of player.talent" class="talent-tag" [attr.data-tooltip]="talentoDescricao(t)">
                                        {{t}}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="col-right">
                            <span class="section-title">Atributos Base</span>
                            <div class="attr-grid" *ngIf="player.status">
                                <div class="attr-card">
                                    <span>FOR</span>
                                    <b>{{player.status[0]}}</b>
                                    <div class="attr-bonus" *ngIf="player.attrBonuses[0]">{{player.attrBonuses[0]}}</div>
                                </div>
                                <div class="attr-card">
                                    <span>DES</span>
                                    <b>{{player.status[1]}}</b>
                                    <div class="attr-bonus" *ngIf="player.attrBonuses[1]">{{player.attrBonuses[1]}}</div>
                                </div>
                                <div class="attr-card">
                                    <span>CON</span>
                                    <b>{{player.status[2]}}</b>
                                    <div class="attr-bonus" *ngIf="player.attrBonuses[2]">{{player.attrBonuses[2]}}</div>
                                </div>
                                <div class="attr-card">
                                    <span>INT</span>
                                    <b>{{player.status[3]}}</b>
                                    <div class="attr-bonus" *ngIf="player.attrBonuses[3]">{{player.attrBonuses[3]}}</div>
                                </div>
                                <div class="attr-card">
                                    <span>SAB</span>
                                    <b>{{player.status[4]}}</b>
                                    <div class="attr-bonus" *ngIf="player.attrBonuses[4]">{{player.attrBonuses[4]}}</div>
                                </div>
                                <div class="attr-card">
                                    <span>CAR</span>
                                    <b>{{player.status[5]}}</b>
                                    <div class="attr-bonus" *ngIf="player.attrBonuses[5]">{{player.attrBonuses[5]}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="action-bar">
            <button (click)="editInfo()" class="action-btn">
                <span>EDITAR DADOS</span>
            </button>
            <button (click)="logout()" class="action-btn btn-logout">
                <span>DESCONECTAR</span>
            </button>
            <button (click)="simulator()" class="action-btn">
                <span>Simulador de batalha</span>
            </button>
        </div>

    </div>

    <ng-template #loading>
        <div style="color: var(--accent-color); font-family: monospace;">INICIALIZANDO SISTEMA...</div>
    </ng-template>
    
</main>